# é¡¹ç›®çŠ¶æ€æŠ¥å‘Š

**é¡¹ç›®åç§°**: éŸ³é¢‘è½¬æ–‡å­—å°ç¨‹åºï¼ˆå¸¦ç²¤è¯­ç¿»è¯‘å’Œæœ—è¯»åŠŸèƒ½ï¼‰
**æœ€åæ›´æ–°**: 2025-12-26
**é¡¹ç›®è´Ÿè´£äºº**: Claude Code

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
4. [å®Œæˆæƒ…å†µ](#å®Œæˆæƒ…å†µ)
5. [æ–‡ä»¶æ¸…å•](#æ–‡ä»¶æ¸…å•)
6. [APIæ–‡æ¡£](#apiæ–‡æ¡£)
7. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
8. [è¿è¡ŒæŒ‡å—](#è¿è¡ŒæŒ‡å—)
9. [å·²çŸ¥é—®é¢˜](#å·²çŸ¥é—®é¢˜)
10. [åç»­è®¡åˆ’](#åç»­è®¡åˆ’)

---

## é¡¹ç›®æ¦‚è¿°

### ç›®æ ‡
ä¸ºå¾®ä¿¡å°ç¨‹åºç”¨æˆ·æä¾›ä¸€ä¸ªå®Œæ•´çš„éŸ³é¢‘å¤„ç†è§£å†³æ–¹æ¡ˆï¼š
- **ç¬¬1æ­¥**: ç”¨æˆ·å½•åˆ¶éŸ³é¢‘ â†’ è¯†åˆ«ä¸ºæ™®é€šè¯æ–‡å­—
- **ç¬¬2æ­¥**: æ˜¾ç¤ºè¯†åˆ«ç»“æœç»™ç”¨æˆ·
- **ç¬¬3æ­¥**ï¼ˆæ–°å¢ï¼‰: ç”¨æˆ·ç‚¹å‡»æŒ‰é’® â†’ ç¿»è¯‘æˆç²¤è¯­ â†’ æœ—è¯»å‡ºæ¥

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ | æä¾›å•† |
|------|------|--------|
| å°ç¨‹åºæ¡†æ¶ | å¾®ä¿¡å°ç¨‹åº | WeChat |
| åç«¯æ¡†æ¶ | Express.js | Node.js |
| è¯­éŸ³è¯†åˆ« | ASR API | è…¾è®¯äº‘ |
| æ–‡æœ¬ç¿»è¯‘ | TMT API | è…¾è®¯äº‘ |
| æ–‡æœ¬è½¬è¯­éŸ³ | TTS API | è…¾è®¯äº‘ |
| éŸ³é¢‘å¤„ç† | FFmpeg | å¼€æº |
| æ–‡ä»¶ä¸Šä¼  | Multer | Node.js |

### é¡¹ç›®ä½ç½®
```
D:\projects\tools-1\
â”œâ”€â”€ audio-to-text-app/        # å°ç¨‹åºå‰ç«¯
â”œâ”€â”€ audio-to-text-backend/    # Node.jsåç«¯
â””â”€â”€ æ–‡æ¡£æ–‡ä»¶
```

---

## é¡¹ç›®ç»“æ„

### å‰ç«¯ç»“æ„ï¼ˆaudio-to-text-app/ï¼‰

```
audio-to-text-app/
â”œâ”€â”€ app.js                 # åº”ç”¨å…¨å±€é€»è¾‘
â”œâ”€â”€ app.json              # åº”ç”¨é…ç½® âœ… å·²ä¿®æ”¹ï¼ˆæ·»åŠ TTSæ’ä»¶é…ç½®ï¼‰
â”œâ”€â”€ app.wxss              # å…¨å±€æ ·å¼
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ index/
â”‚   â”‚   â”œâ”€â”€ index.js      # é¦–é¡µ - å½•éŸ³é€»è¾‘ âœ… å·²å®Œæˆ
â”‚   â”‚   â”œâ”€â”€ index.wxml    # é¦–é¡µ - ç•Œé¢
â”‚   â”‚   â””â”€â”€ index.wxss    # é¦–é¡µ - æ ·å¼
â”‚   â””â”€â”€ result/
â”‚       â”œâ”€â”€ result.js     # ç»“æœé¡µ - æ˜¾ç¤ºè¯†åˆ«ç»“æœ â³ å¾…å®Œæˆç¿»è¯‘/æœ—è¯»åŠŸèƒ½
â”‚       â”œâ”€â”€ result.wxml   # ç»“æœé¡µ - ç•Œé¢ â³ å¾…æ·»åŠ ç¿»è¯‘æŒ‰é’®
â”‚       â””â”€â”€ result.wxss   # ç»“æœé¡µ - æ ·å¼ â³ å¾…æ·»åŠ æŒ‰é’®æ ·å¼
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ request.js        # APIè¯·æ±‚å·¥å…· â³ å¾…æ·»åŠ translateText()å‡½æ•°
â””â”€â”€ sitemap.json
```

### åç«¯ç»“æ„ï¼ˆaudio-to-text-backend/ï¼‰

```
audio-to-text-backend/
â”œâ”€â”€ server.js             # åŸå§‹æœåŠ¡å™¨ âœ… å·²å®Œæˆï¼ˆéŸ³é¢‘è¯†åˆ«åŠŸèƒ½ï¼‰
â”œâ”€â”€ server-v2.js          # æ–°æœåŠ¡å™¨ âœ… å·²å®Œæˆï¼ˆæ–°å¢ç¿»è¯‘+TTSï¼‰
â”œâ”€â”€ translation-service.js # ç¿»è¯‘å’ŒTTSæœåŠ¡æ¨¡å— âœ… å·²åˆ›å»º
â”œâ”€â”€ api-routes.js         # APIè·¯ç”±å®šä¹‰ âœ… å·²åˆ›å»º
â”œâ”€â”€ test-translate.js     # ç¿»è¯‘APIæµ‹è¯•è„šæœ¬ âœ… å·²åˆ›å»ºï¼ˆæµ‹è¯•é€šè¿‡ï¼‰
â”œâ”€â”€ test-asr.js           # ASR APIæµ‹è¯•è„šæœ¬
â”œâ”€â”€ package.json          # ä¾èµ–é…ç½®
â”œâ”€â”€ .env                  # ç¯å¢ƒå˜é‡ â³ éœ€è¦é…ç½®
â”œâ”€â”€ uploads/              # ä¸Šä¼ å’Œä¸´æ—¶æ–‡ä»¶ç›®å½•
â””â”€â”€ README.md             # é¡¹ç›®è¯´æ˜
```

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. éŸ³é¢‘å½•åˆ¶å’Œè¯†åˆ« âœ… å·²å®Œæˆ

**å‰ç«¯**:
- å¾®ä¿¡å°ç¨‹åºå½•éŸ³API
- æ”¯æŒæœ€é•¿60ç§’å½•éŸ³
- å½•éŸ³æ—¶é•¿å®æ—¶æ˜¾ç¤º

**åç«¯**:
- æ¥æ”¶M4Aæ ¼å¼éŸ³é¢‘
- ä½¿ç”¨FFmpegè½¬ç ä¸ºWAV
- è°ƒç”¨è…¾è®¯äº‘ASR APIè¿›è¡Œè¯†åˆ«
- å¼‚æ­¥åå°è½®è¯¢è·å–ç»“æœ

**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
- ç”¨æˆ·å¯ä»¥å½•åˆ¶éŸ³é¢‘
- åç«¯æˆåŠŸè¯†åˆ«å¹¶è¿”å›æ–‡å­—

---

### 2. ç²¤è¯­ç¿»è¯‘ â³ éƒ¨åˆ†å®Œæˆ

**åç«¯** âœ… å·²å®Œæˆ:
- åˆ›å»ºäº† `translation-service.js` æ¨¡å—
- å®ç° `/api/translate` ç«¯ç‚¹
- æ”¯æŒ zh-HK å’Œ zh-TW è¯­è¨€ä»£ç 
- é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥
- **æµ‹è¯•ç»“æœ**: ä¸¤ä¸ªè¯­è¨€ä»£ç éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼

**å‰ç«¯** â³ å¾…å®Œæˆ:
- [ ] åœ¨ `request.js` ä¸­æ·»åŠ  `translateText()` å‡½æ•°
- [ ] åœ¨ `result.js` ä¸­æ·»åŠ ç¿»è¯‘æŒ‰é’®å¤„ç†é€»è¾‘
- [ ] åœ¨ `result.wxml` ä¸­æ·»åŠ UIæŒ‰é’®
- [ ] åœ¨ `result.wxss` ä¸­æ·»åŠ æ ·å¼

**æµ‹è¯•çŠ¶æ€**: âœ… åç«¯ç¿»è¯‘APIæµ‹è¯•é€šè¿‡
```
è¾“å…¥: ä½ å¥½ï¼Œæˆ‘æ˜¯è¯­éŸ³è½¬æ–‡å­—åŠ©æ‰‹
è¾“å‡º (zh-HK): ä½ å¥½ï¼Œæˆ‘æ˜¯èªéŸ³è½‰æ–‡å­—åŠ©æ‰‹ âœ…
è¾“å‡º (zh-TW): ä½ å¥½ï¼Œæˆ‘æ˜¯èªéŸ³è½‰æ–‡å­—åŠ©æ‰‹ âœ…
```

---

### 3. æ–‡æœ¬è½¬è¯­éŸ³(TTS) â³ å·²å®ç°ï¼Œå¾…æµ‹è¯•

**åç«¯** âœ… å·²å®Œæˆ:
- åˆ›å»º `textToSpeech()` å‡½æ•°
- å®ç° `/api/text-to-speech` ç«¯ç‚¹
- æ”¯æŒWAVå’ŒMP3è¾“å‡º
- è¿”å›éŸ³é¢‘Buffer

**å‰ç«¯** â³ å¾…å®Œæˆ:
- [ ] ä½¿ç”¨ `wx.playVoice()` æˆ– `wx.playBackgroundMusic()` æ’­æ”¾éŸ³é¢‘
- [ ] å¤„ç†éŸ³é¢‘ä¸‹è½½å’Œç¼“å­˜
- [ ] æ˜¾ç¤ºæ’­æ”¾è¿›åº¦

**å¾®ä¿¡TTSæ’ä»¶é—®é¢˜** âš ï¸:
- å°è¯•ä½¿ç”¨å¾®ä¿¡å®˜æ–¹TTSæ’ä»¶ `WechatSI`
- é‡åˆ° "æ’ä»¶å†…å®¹è·å–ä¸åˆ°" é—®é¢˜
- å·²æ”¹ä¸ºåç«¯TTSæ–¹æ¡ˆï¼ˆæ›´å¯æ§ï¼‰

---

## å®Œæˆæƒ…å†µ

### å·²å®Œæˆ âœ…

| åŠŸèƒ½ | æ¨¡å— | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|------|
| å‰ç«¯å½•éŸ³ | pages/index/index.js | âœ… | å®Œå…¨å¯ç”¨ |
| åç«¯è¯†åˆ« | server.js | âœ… | ç”Ÿäº§å°±ç»ª |
| å¼‚æ­¥è½®è¯¢ | server.js | âœ… | ä¼˜åŒ–å®Œæˆ |
| ç¿»è¯‘æœåŠ¡ | translation-service.js | âœ… | å·²æµ‹è¯•é€šè¿‡ |
| ç¿»è¯‘API | api-routes.js | âœ… | å·²å®ç° |
| TTSæœåŠ¡ | translation-service.js | âœ… | å·²å®ç° |
| TTS API | api-routes.js | âœ… | å·²å®ç° |
| æ–°æœåŠ¡å™¨ | server-v2.js | âœ… | å·²åˆ›å»º |
| éŸ³é¢‘ä¸‹è½½ | api-routes.js | âœ… | å·²å®ç° |

### æ­£åœ¨è¿›è¡Œ ğŸ”„

| åŠŸèƒ½ | ä»»åŠ¡ | è¿›åº¦ |
|------|------|------|
| åç«¯æµ‹è¯• | æµ‹è¯•ç¿»è¯‘å’ŒTTSç«¯ç‚¹ | 50% |

### å¾…å®Œæˆ â³

| åŠŸèƒ½ | ä»»åŠ¡ | ä¼˜å…ˆçº§ |
|------|------|--------|
| å‰ç«¯ç¿»è¯‘å‡½æ•° | åœ¨request.jsä¸­æ·»åŠ translateText() | é«˜ |
| å‰ç«¯ç¿»è¯‘æŒ‰é’® | åœ¨resulté¡µé¢æ·»åŠ UIå’Œé€»è¾‘ | é«˜ |
| å‰ç«¯éŸ³é¢‘æ’­æ”¾ | é›†æˆwx.playVoice()æ’­æ”¾TTSéŸ³é¢‘ | é«˜ |
| å‰ç«¯å®Œæ•´æµ‹è¯• | ç«¯åˆ°ç«¯æµ‹è¯•ç¿»è¯‘â†’è¯†åˆ«â†’æœ—è¯»æµç¨‹ | é«˜ |
| é”™è¯¯å¤„ç†ä¼˜åŒ– | å®Œå–„æ‰€æœ‰é”™è¯¯æç¤ºä¿¡æ¯ | ä¸­ |
| æ€§èƒ½ä¼˜åŒ– | ä¼˜åŒ–ç¿»è¯‘ç¼“å­˜ã€å¹¶å‘æ§åˆ¶ | ä¸­ |
| éƒ¨ç½²ä¸Šçº¿ | éƒ¨ç½²åˆ°è…¾è®¯äº‘/å…¶ä»–å¹³å° | ä½ |
| æ–‡æ¡£å®Œå–„ | ç¼–å†™ç”¨æˆ·æ‰‹å†Œå’Œå¼€å‘æ–‡æ¡£ | ä½ |

---

## æ–‡ä»¶æ¸…å•

### åç«¯æ–°æ–‡ä»¶ï¼ˆå·²åˆ›å»ºï¼‰

#### 1. `translation-service.js` âœ…
**åŠŸèƒ½**: ç¿»è¯‘å’ŒTTSæœåŠ¡çš„æ ¸å¿ƒé€»è¾‘
- `initTencentTranslationClient()` - åˆå§‹åŒ–ç¿»è¯‘å®¢æˆ·ç«¯
- `initTencentTTSClient()` - åˆå§‹åŒ–TTSå®¢æˆ·ç«¯
- `translateText()` - ç¿»è¯‘æ–‡æœ¬ï¼ˆæ”¯æŒzh-HKå’Œzh-TWï¼Œå¸¦é™çº§ï¼‰
- `textToSpeech()` - æ–‡æœ¬è½¬è¯­éŸ³
- `translateAndSpeech()` - ç»„åˆåŠŸèƒ½

**è¡Œæ•°**: 199è¡Œ
**æµ‹è¯•çŠ¶æ€**: â³ å¾…æµ‹è¯•

#### 2. `api-routes.js` âœ…
**åŠŸèƒ½**: Expressè·¯ç”±å®šä¹‰
- `POST /api/translate` - ç¿»è¯‘ç«¯ç‚¹
- `POST /api/text-to-speech` - TTSç«¯ç‚¹
- `POST /api/translate-and-speak` - ç¿»è¯‘+TTSç»„åˆ
- `GET /download/:filename` - éŸ³é¢‘ä¸‹è½½

**è¡Œæ•°**: 305è¡Œ
**æµ‹è¯•çŠ¶æ€**: â³ å¾…æµ‹è¯•

#### 3. `server-v2.js` âœ…
**åŠŸèƒ½**: æ”¹è¿›çš„æœåŠ¡å™¨ï¼ˆåŒ…å«æ‰€æœ‰åŠŸèƒ½ï¼‰
- åŒ…å«åŸserver.jsçš„æ‰€æœ‰åŠŸèƒ½
- é›†æˆæ–°çš„api-routes
- æ·»åŠ é™æ€æ–‡ä»¶æœåŠ¡
- æ–°å¢APIç«¯ç‚¹æ–‡æ¡£è¾“å‡º

**è¡Œæ•°**: 463è¡Œ
**å¯åŠ¨æ–¹å¼**:
```bash
set PORT=9001
node server-v2.js
```

#### 4. `test-translate.js` âœ…
**åŠŸèƒ½**: å¿«é€Ÿæµ‹è¯•ç¿»è¯‘API
- æµ‹è¯•zh-HKæ”¯æŒ âœ… é€šè¿‡
- æµ‹è¯•zh-TWæ”¯æŒ âœ… é€šè¿‡

**æµ‹è¯•ç»“æœ**:
```
âœ… zh-HK: ä½ å¥½ï¼Œæˆ‘æ˜¯èªéŸ³è½‰æ–‡å­—åŠ©æ‰‹
âœ… zh-TW: ä½ å¥½ï¼Œæˆ‘æ˜¯èªéŸ³è½‰æ–‡å­—åŠ©æ‰‹
```

### å‰ç«¯ä¿®æ”¹ï¼ˆå¾…å®Œæˆï¼‰

#### 1. `app.json` âœ… å·²ä¿®æ”¹
**ä¿®æ”¹å†…å®¹**: æ·»åŠ TTSæ’ä»¶é…ç½®ï¼ˆåæ”¹ç”¨åç«¯æ–¹æ¡ˆï¼Œé…ç½®å¯ä¿ç•™æˆ–ç§»é™¤ï¼‰

#### 2. `utils/request.js` â³ å¾…ä¿®æ”¹
**éœ€è¦æ·»åŠ **:
```javascript
function translateText(text, sourceLang = 'zh', targetLang = 'zh-HK')
// è¿”å›ç¿»è¯‘åçš„æ–‡æœ¬

function downloadAndPlayAudio(audioUrl)
// ä¸‹è½½å¹¶æ’­æ”¾éŸ³é¢‘æ–‡ä»¶
```

#### 3. `pages/result/result.js` â³ å¾…ä¿®æ”¹
**éœ€è¦æ·»åŠ **:
- dataå±æ€§: `cantoneseText`, `translating`, `speaking`
- æ–¹æ³•: `translateAndSpeak()`, `playAudio()`, `stopAudio()`

#### 4. `pages/result/result.wxml` â³ å¾…ä¿®æ”¹
**éœ€è¦æ·»åŠ **:
- ç¿»è¯‘æŒ‰é’®ï¼ˆåœ¨å¤åˆ¶æŒ‰é’®åï¼‰
- åŠ è½½æç¤ºæ–‡æœ¬

#### 5. `pages/result/result.wxss` â³ å¾…ä¿®æ”¹
**éœ€è¦æ·»åŠ **:
- `.btn-translate` æ ·å¼
- åŠ è½½çŠ¶æ€æ ·å¼

---

## APIæ–‡æ¡£

### åç«¯APIç«¯ç‚¹

#### 1. å¥åº·æ£€æŸ¥
```
GET /health
```
**å“åº”**:
```json
{
  "code": 0,
  "message": "Server is running",
  "timestamp": "2025-12-26T10:30:00.000Z"
}
```

#### 2. éŸ³é¢‘è¯†åˆ« (åŸæœ‰)
```
POST /api/audio-to-text
Content-Type: multipart/form-data

å‚æ•°:
- audio: éŸ³é¢‘æ–‡ä»¶ (M4Aæ ¼å¼)

å“åº”:
{
  "code": 0,
  "message": "success",
  "data": {
    "taskId": 123456789,
    "status": "processing"
  }
}
```

#### 3. æŸ¥è¯¢è¯†åˆ«ç»“æœ (åŸæœ‰)
```
GET /api/audio-to-text/status/:taskId

å“åº”:
{
  "code": 0,
  "message": "success",
  "data": {
    "taskId": 123456789,
    "status": "completed|processing|failed",
    "result": "è¯†åˆ«çš„æ–‡å­—",
    "attempts": 5
  }
}
```

#### 4. ç¿»è¯‘ âœ… æ–°å¢
```
POST /api/translate
Content-Type: application/json

è¯·æ±‚ä½“:
{
  "text": "ä½ å¥½ä¸–ç•Œ",
  "sourceLang": "zh",        // å¯é€‰ï¼Œé»˜è®¤'zh'
  "targetLang": "zh-HK"      // å¯é€‰ï¼Œé»˜è®¤'zh-HK'
}

å“åº”:
{
  "code": 0,
  "message": "success",
  "data": {
    "translatedText": "ä½ å¥½ä¸–ç•Œ",
    "sourceLang": "zh",
    "targetLang": "zh-HK"
  }
}

é”™è¯¯å“åº”:
{
  "code": 1,
  "message": "ä¸æ”¯æŒçš„è¯­è¨€ä»£ç ",
  "details": "ç›®æ ‡è¯­è¨€å¯èƒ½ä¸æ”¯æŒã€‚å°è¯•ä½¿ç”¨ zh-TWï¼ˆç¹ä½“ä¸­æ–‡ï¼‰ä»£æ›¿ã€‚",
  "error": "..."
}
```

#### 5. æ–‡æœ¬è½¬è¯­éŸ³ âœ… æ–°å¢
```
POST /api/text-to-speech
Content-Type: application/json

è¯·æ±‚ä½“:
{
  "text": "ä½ å¥½ä¸–ç•Œ",
  "outputFormat": "wav",     // å¯é€‰ï¼š'wav'æˆ–'mp3'ï¼Œé»˜è®¤'wav'
  "voiceType": 0,            // å¯é€‰ï¼š0=æ™®é€šè¯å¥³æ€§ï¼Œé»˜è®¤0
  "sampleRate": 16000        // å¯é€‰ï¼šé‡‡æ ·ç‡ï¼Œé»˜è®¤16000Hz
}

å“åº”:
éŸ³é¢‘æ–‡ä»¶å†…å®¹ (äºŒè¿›åˆ¶)
Content-Type: audio/wav (æˆ– audio/mp3)
```

#### 6. ç¿»è¯‘+TTS âœ… æ–°å¢
```
POST /api/translate-and-speak
Content-Type: application/json

è¯·æ±‚ä½“:
{
  "text": "ä½ å¥½ä¸–ç•Œ",
  "targetLang": "zh-HK",     // å¯é€‰ï¼Œé»˜è®¤'zh-HK'
  "outputFormat": "wav"      // å¯é€‰ï¼Œé»˜è®¤'wav'
}

å“åº”:
{
  "code": 0,
  "message": "success",
  "data": {
    "translatedText": "ä½ å¥½ä¸–ç•Œ",
    "audioUrl": "/download/audio_12345.wav",
    "audioSize": 123456
  }
}
```

#### 7. ä¸‹è½½éŸ³é¢‘æ–‡ä»¶ âœ… æ–°å¢
```
GET /download/:filename

ç¤ºä¾‹:
GET /download/audio_1735210200000_abc123.wav

å“åº”:
éŸ³é¢‘æ–‡ä»¶å†…å®¹ (äºŒè¿›åˆ¶)
```

---

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ (.envæ–‡ä»¶)

```env
# ç«¯å£é…ç½®
PORT=9001

# è…¾è®¯äº‘é…ç½®
TENCENT_SECRET_ID=your_secret_id_here
TENCENT_SECRET_KEY=your_secret_key_here
TENCENT_REGION=ap-beijing

# Nodeç¯å¢ƒ
NODE_ENV=development
```

### ä¾èµ–åŒ…

**åç«¯ä¾èµ–** (package.json):
```json
{
  "dependencies": {
    "express": "^4.18.2",
    "multer": "^1.4.5-lts.1",
    "cors": "^2.8.5",
    "fluent-ffmpeg": "^2.1.2",
    "ffmpeg-static": "^5.1.0",
    "tencentcloud-sdk-nodejs": "^4.0.670",
    "dotenv": "^16.0.3"
  }
}
```

**å®‰è£…å‘½ä»¤**:
```bash
cd D:\projects\tools-1\audio-to-text-backend
npm install
```

---

## è¿è¡ŒæŒ‡å—

### å¯åŠ¨åç«¯æœåŠ¡

**æ–¹æ³•1: ä½¿ç”¨æ–°ç‰ˆserver-v2.jsï¼ˆæ¨èï¼‰**
```bash
cd D:\projects\tools-1\audio-to-text-backend
set PORT=9001
node server-v2.js
```

**æ–¹æ³•2: ä½¿ç”¨åŸç‰ˆserver.js**
```bash
cd D:\projects\tools-1\audio-to-text-backend
set PORT=9001
node server.js
```

**é¢„æœŸè¾“å‡º**:
```
========================================
ğŸš€ éŸ³é¢‘è½¬æ–‡å­—æœåŠ¡å™¨å·²å¯åŠ¨ï¼ˆv2ï¼‰
ğŸ“ ç›‘å¬åœ°å€: http://localhost:9001
ğŸ¤ éŸ³é¢‘ç¼–ç : M4A â†’ WAV (16kHz, å•å£°é“)
ğŸ¤– è¯†åˆ«å¼•æ“: è…¾è®¯äº‘ ASR
ğŸŒ ç¿»è¯‘å¼•æ“: è…¾è®¯äº‘ TMT
ğŸ™ï¸ TTSå¼•æ“: è…¾è®¯äº‘ TTS
========================================

âœ… å¯ç”¨çš„APIç«¯ç‚¹ï¼š
   GET  http://localhost:9001/health
   POST http://localhost:9001/api/audio-to-text (çœŸå®è¯†åˆ«)
   GET  http://localhost:9001/api/audio-to-text/status/:taskId (æŸ¥è¯¢çŠ¶æ€)
   POST http://localhost:9001/api/audio-to-text-mock (æ¨¡æ‹Ÿè¯†åˆ«)
   POST http://localhost:9001/api/translate (ç¿»è¯‘)
   POST http://localhost:9001/api/text-to-speech (TTS)
   POST http://localhost:9001/api/translate-and-speak (ç¿»è¯‘+TTS)
```

### æµ‹è¯•APIç«¯ç‚¹

**æµ‹è¯•ç¿»è¯‘API**:
```bash
# åœ¨å¦ä¸€ä¸ªPowerShellçª—å£ä¸­
curl -X POST http://localhost:9001/api/translate `
  -H "Content-Type: application/json" `
  -d "{\"text\":\"ä½ å¥½ä¸–ç•Œ\",\"targetLang\":\"zh-HK\"}"
```

**æµ‹è¯•TTS API**:
```bash
curl -X POST http://localhost:9001/api/text-to-speech `
  -H "Content-Type: application/json" `
  -d "{\"text\":\"ä½ å¥½ä¸–ç•Œ\"}" `
  -o output.wav
```

### å¯åŠ¨å°ç¨‹åºå‰ç«¯

1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. é€‰æ‹©é¡¹ç›®ç›®å½•: `D:\projects\tools-1\audio-to-text-app`
3. ç‚¹å‡»"é¢„è§ˆ"æˆ–"ç¼–è¯‘"
4. åœ¨æ¨¡æ‹Ÿå™¨ä¸­æµ‹è¯•

---

## å·²çŸ¥é—®é¢˜

### 1. æ–‡ä»¶ç¼–è¾‘å†²çª âš ï¸
**é—®é¢˜**: ç¼–è¾‘ `server.js` æ—¶å‡ºç° "File has been unexpectedly modified" é”™è¯¯
**åŸå› **: æ–‡ä»¶è¢«IDEæˆ–å…¶ä»–è¿›ç¨‹é”å®š
**è§£å†³**: åˆ›å»ºäº†æ–°çš„ `server-v2.js` ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆ
**çŠ¶æ€**: âœ… å·²è§£å†³

### 2. å¾®ä¿¡TTSæ’ä»¶ä¸å¯ç”¨ âš ï¸
**é—®é¢˜**: å°è¯•ä½¿ç”¨å¾®ä¿¡å®˜æ–¹ `WechatSI` æ’ä»¶æ—¶æ˜¾ç¤º "æ’ä»¶å†…å®¹è·å–ä¸åˆ°"
**åŸå› **: éœ€è¦åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°åå°é…ç½®å’Œæˆæƒæ’ä»¶
**è§£å†³**: æ”¹ç”¨åç«¯TTSæ–¹æ¡ˆï¼ˆä½¿ç”¨è…¾è®¯äº‘TTS APIï¼‰
**çŠ¶æ€**: âœ… å·²è§£å†³

### 3. ç²¤è¯­æ”¯æŒä¸ç¡®å®š âš ï¸
**é—®é¢˜**: åˆæœŸä¸ç¡®å®šè…¾è®¯äº‘æ˜¯å¦æ”¯æŒç²¤è¯­ç¿»è¯‘å’ŒTTS
**è§£å†³**:
- æµ‹è¯•ç»“æœ: âœ… ç¿»è¯‘APIæ”¯æŒ zh-HK å’Œ zh-TW
- å·²åˆ›å»ºå›é€€ç­–ç•¥: zh-HK â†’ zh-TW â†’ æ˜¾ç¤ºé”™è¯¯æç¤º
**çŠ¶æ€**: âœ… å·²è§£å†³

### 4. PowerShellå‘½ä»¤æ‰§è¡Œ âš ï¸
**é—®é¢˜**: PowerShellä¸æ”¯æŒ `&&` å‘½ä»¤è¿æ¥ç¬¦
**è§£å†³**: ä½¿ç”¨ `;` æˆ–åˆ†å¼€æ‰§è¡Œå‘½ä»¤
**çŠ¶æ€**: âœ… å·²è§£å†³

---

## åç»­è®¡åˆ’

### Phase 1: å‰ç«¯é›†æˆï¼ˆå½“å‰ï¼‰â³

**æ—¶é—´**: æœ¬å‘¨
**ä»»åŠ¡**:
- [ ] æ·»åŠ  `translateText()` å‡½æ•°åˆ° request.js
- [ ] åœ¨ result.js ä¸­å®ç°ç¿»è¯‘é€»è¾‘
- [ ] æ·»åŠ ç¿»è¯‘æŒ‰é’®åˆ° result.wxml
- [ ] å®ç°éŸ³é¢‘æ’­æ”¾åŠŸèƒ½
- [ ] å®Œæˆå‰ç«¯UIå’Œäº¤äº’

**æ£€æŸ¥ç‚¹**:
- [ ] ç¿»è¯‘æŒ‰é’®æ˜¾ç¤ºæ­£ç¡®
- [ ] ç‚¹å‡»ç¿»è¯‘åæ˜¾ç¤ºåŠ è½½çŠ¶æ€
- [ ] ç¿»è¯‘ç»“æœæ­£ç¡®æ˜¾ç¤º
- [ ] éŸ³é¢‘æ–‡ä»¶èƒ½æ­£å¸¸æ’­æ”¾

### Phase 2: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆä¸‹å‘¨ï¼‰â³

**ä»»åŠ¡**:
- [ ] ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•ï¼ˆå½•éŸ³â†’è¯†åˆ«â†’ç¿»è¯‘â†’æœ—è¯»ï¼‰
- [ ] é”™è¯¯å¤„ç†æµ‹è¯•ï¼ˆå„ç§å¤±è´¥åœºæ™¯ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆå“åº”æ—¶é—´ã€å¹¶å‘ï¼‰
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–

**æµ‹è¯•ç”¨ä¾‹**:
- [ ] å½•åˆ¶ä¸­æ–‡è¯­éŸ³ â†’ è¯†åˆ« â†’ ç¿»è¯‘ â†’ æœ—è¯»
- [ ] ç½‘ç»œæ–­å¼€æ—¶çš„å¤„ç†
- [ ] APIè¶…æ—¶çš„å¤„ç†
- [ ] é•¿æ–‡æœ¬çš„å¤„ç†
- [ ] å¿«é€Ÿè¿ç»­æ“ä½œ

### Phase 3: éƒ¨ç½²ï¼ˆä¸¤å‘¨åï¼‰â³

**ä»»åŠ¡**:
- [ ] éƒ¨ç½²åç«¯åˆ°è…¾è®¯äº‘/å…¶ä»–äº‘å¹³å°
- [ ] æ›´æ–°å°ç¨‹åºçš„APIåœ°å€
- [ ] è¿›è¡Œæœ€åçš„é›†æˆæµ‹è¯•
- [ ] æäº¤å°ç¨‹åºå®¡æ ¸

**é…ç½®**:
- [ ] é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
- [ ] è®¾ç½®æ•°æ®åº“ï¼ˆå­˜å‚¨è¯†åˆ«å’Œç¿»è¯‘ç»“æœï¼‰
- [ ] é…ç½®CDNï¼ˆå­˜å‚¨éŸ³é¢‘æ–‡ä»¶ï¼‰
- [ ] é…ç½®ç›‘æ§å’Œæ—¥å¿—

### Phase 4: åŠŸèƒ½æ‰©å±•ï¼ˆä¹‹åï¼‰ğŸ”®

**å¯é€‰åŠŸèƒ½**:
- [ ] æ”¯æŒæ›´å¤šè¯­è¨€çš„ç¿»è¯‘
- [ ] æ”¯æŒç²¤è¯­è¯­éŸ³è¯†åˆ«ï¼ˆå¦‚æœè…¾è®¯äº‘æ”¯æŒï¼‰
- [ ] ç¿»è¯‘ç»“æœç¼“å­˜
- [ ] è¯†åˆ«ç»“æœå†å²è®°å½•
- [ ] ç¦»çº¿ç¿»è¯‘åŠŸèƒ½
- [ ] ç”¨æˆ·è´¦æˆ·ç³»ç»Ÿ
- [ ] ä»˜è´¹APIé™åˆ¶

---

## æŠ€æœ¯å€ºåŠ¡

### é«˜ä¼˜å…ˆçº§

1. **æ•°æ®åº“é›†æˆ**
   - å½“å‰ç”¨å†…å­˜Mapå­˜å‚¨ä»»åŠ¡çŠ¶æ€
   - åº”è¯¥ä½¿ç”¨æ•°æ®åº“ï¼ˆRedis/MySQLï¼‰
   - ä¾¿äºæŒä¹…åŒ–å’Œåˆ†å¸ƒå¼éƒ¨ç½²

2. **é”™è¯¯æ—¥å¿—**
   - åº”è¯¥ä½¿ç”¨ä¸“ä¸šçš„æ—¥å¿—åº“ï¼ˆwinston/pinoï¼‰
   - ä¾¿äºçº¿ä¸Šé—®é¢˜è¯Šæ–­

3. **APIè®¤è¯**
   - å½“å‰æ²¡æœ‰è®¤è¯æœºåˆ¶
   - åº”è¯¥æ·»åŠ Token/OAuthè®¤è¯

### ä¸­ä¼˜å…ˆçº§

1. **é€Ÿç‡é™åˆ¶**
   - é˜²æ­¢APIæ»¥ç”¨
   - ä½¿ç”¨express-rate-limit

2. **ç¼“å­˜ç­–ç•¥**
   - ç¼“å­˜ç¿»è¯‘ç»“æœå‡å°‘APIè°ƒç”¨
   - ç¼“å­˜TTSéŸ³é¢‘æ–‡ä»¶

3. **å•å…ƒæµ‹è¯•**
   - ç¼ºå°‘è‡ªåŠ¨åŒ–æµ‹è¯•
   - åº”è¯¥æ·»åŠ Jest/Mochaæµ‹è¯•

### ä½ä¼˜å…ˆçº§

1. **ä»£ç æ–‡æ¡£**
   - è¡¥å……JSDocæ³¨é‡Š
   - ç¼–å†™APIæ–‡æ¡£

2. **æ€§èƒ½ä¼˜åŒ–**
   - éŸ³é¢‘å‹ç¼©
   - å¹¶å‘æ§åˆ¶

---

## å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨åç«¯
cd D:\projects\tools-1\audio-to-text-backend
set PORT=9001 && node server-v2.js

# æµ‹è¯•ç¿»è¯‘
curl -X POST http://localhost:9001/api/translate \
  -H "Content-Type: application/json" \
  -d "{\"text\":\"ä½ å¥½ä¸–ç•Œ\",\"targetLang\":\"zh-HK\"}"

# æµ‹è¯•TTS
curl -X POST http://localhost:9001/api/text-to-speech \
  -H "Content-Type: application/json" \
  -d "{\"text\":\"ä½ å¥½ä¸–ç•Œ\"}" -o output.wav

# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:9001/health
```

### å…³é”®æ–‡ä»¶ä½ç½®

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| åç«¯ä¸»æ–‡ä»¶ | `audio-to-text-backend/server-v2.js` | æœ€æ–°ç‰ˆæœ¬ |
| ç¿»è¯‘æœåŠ¡ | `audio-to-text-backend/translation-service.js` | æ ¸å¿ƒé€»è¾‘ |
| å‰ç«¯é¦–é¡µ | `audio-to-text-app/pages/index/index.js` | å½•éŸ³åŠŸèƒ½ |
| å‰ç«¯ç»“æœé¡µ | `audio-to-text-app/pages/result/result.js` | å¾…ä¿®æ”¹ |
| ç¯å¢ƒé…ç½® | `audio-to-text-backend/.env` | è…¾è®¯äº‘å¯†é’¥ |

---

## æ›´æ–°æ—¥å¿—

### 2025-12-26

**æ–°å¢**:
- âœ… åˆ›å»º `translation-service.js` æ¨¡å—
- âœ… åˆ›å»º `api-routes.js` è·¯ç”±å®šä¹‰
- âœ… åˆ›å»º `server-v2.js` æ–°æœåŠ¡å™¨
- âœ… å®ç° `/api/translate` ç«¯ç‚¹
- âœ… å®ç° `/api/text-to-speech` ç«¯ç‚¹
- âœ… å®ç° `/api/translate-and-speak` ç»„åˆç«¯ç‚¹
- âœ… æµ‹è¯•ç¿»è¯‘APIï¼ˆzh-HK, zh-TWéƒ½é€šè¿‡ï¼‰

**ä¿®æ”¹**:
- ä¿®æ”¹ `app.json` æ·»åŠ TTSæ’ä»¶é…ç½®ï¼ˆåæ”¹ä¸ºåç«¯æ–¹æ¡ˆï¼‰

**æ–‡æ¡£**:
- åˆ›å»º `PROJECT_STATUS.md` (æœ¬æ–‡ä»¶)

**å·²è§£å†³é—®é¢˜**:
- âœ… æ–‡ä»¶ç¼–è¾‘å†²çªï¼ˆä½¿ç”¨æ–°æ–‡ä»¶ï¼‰
- âœ… å¾®ä¿¡TTSæ’ä»¶é—®é¢˜ï¼ˆæ”¹ç”¨åç«¯æ–¹æ¡ˆï¼‰
- âœ… ç²¤è¯­æ”¯æŒéªŒè¯ï¼ˆç¿»è¯‘APIé€šè¿‡æµ‹è¯•ï¼‰

---

**æœ€åä¸€æ¬¡æ›´æ–°**: 2025-12-26 10:30:00
**ä¸‹ä¸€ä¸ªæ£€æŸ¥ç‚¹**: å‰ç«¯ç¿»è¯‘é›†æˆå®Œæˆ

